<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
   <head profile="http://gmpg.org/xfn/11">
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

      <link rel="stylesheet" type="text/css" href="bootstrap.css">
      <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>
      <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js'></script>
      <script src="jquery.csv.min.js"></script>
      <script src="bootstrap.min.js"></script>
      <script src="choropleth.js"></script>
      <script type="text/javascript">
         $(document).ready(function(){
            $("#myModal").modal('show');
            });
      </script>
   </head>
   
   <body>
      <h1>Best Location New Business App</h1>
      <p></p>            <!-- Trigger/Open The Modal -->
      <div class = row>
         <button id="myBtn" data-toggle="modal" data-target="#myModal">Update Weights</button>
         <!-- The Modal -->
         <div id="myModal" class="modal fade">       
            <!-- Modal content -->
               <div class="modal-dialog">
                  <div class="modal-content">
                     <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Our App: Assign weights to these factors.</h4>
                        <p>Total should be 0.8</p>
                     </div>
                     <div class="modal-body">
                        <div class = "row">
                           <div class = "col-sm-4 text-left">
                              <p>Competition</p>
                              <input type="number" value="0.0" step="0.1" min="0" max="1" id="WtCompetition">
                              <p>Rent</p>
                              <input type="number" value="0.0" step="0.1" min="0" max="1" id="WtRent">
                           </div>
                           <div class = "col-sm-4 text-left">
                              <p>Connectivity</p>
                              <input type="number" value="0.0" step="0.1" min="0" max="1" id="WtConnectivity">
                              <p>Popularity</p>
                              <input type="number" value="0.0" step="0.1" min="0" max="1" id="WtPopularity">
                              <br>
                              <br>
                              <button type="submit" class="btn btn-primary" onclick = "update()" >Submit</button>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      <div class = "row">
            <div id="map" style="width: 800px; height: 1000px; border: 1px solid #AAA;"></div>
            <script type='text/javascript'>
               var map = L.map( 'map').setView([40.7613292,-73.9834088],12);
               
               L.tileLayer( 'https://api.mapbox.com/styles/v1/rcastellanes/cjb22z4ui7jfz2stqtdw2f2kg/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmNhc3RlbGxhbmVzIiwiYSI6IkVRd0dDaVEifQ.EsWXaa4BxE2qtGQ658rXqQ', {
                  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">MapBox</a>'
               }).addTo( map );
            //</script>
            <script>
            function update() {
               var WtCompetition = $("#WtCompetition").val();
               var WtRent = $("#WtRent").val();
               var WtConnectivity = $("#WtConnectivity").val();
               var WtPopularity = $("#WtPopularity").val();
               $('#myModal').modal('hide');

               
               $.get('https://amla26.github.io/columbia_capstone_2017/nyc-check-ins/final_viz_mh_df.csv', function(data) {mapData(data);
                        });
               
               function getColor(d) {
                        return d > 0.875 ? '#005824' :
                        d > 0.8125 ? '#238B45' :
                        d > 0.750 ? '#41AE76' :
                        d > 0.6875 '#66C2A4' :
                        d > 0.625 ? '#99D8C9' :
                        d > 0.500 ? '#CCECE6' :
                        d > 0.250 ? '#E5f5F9' :
                        '#F7FCFD';
                     }
               
               function mapData(data) {
                  
                  var dataset = $.csv.toObjects(data);
                  var datasetLength = dataset.length;
                  var marker;
                  
                  
                  
                  for (var i = 0; i < datasetLength; i++) {
                     var currentDataPoint = dataset[i];
                     
                     var weightedscore = WtCompetition * currentDataPoint.competitors + WtPopularity * currentDataPoint.rating + WtRent * currentDataPoint.rent + WtConnectivity * currentDataPoint.sub_count + 0.2 * currentDataPoint.unsupervised_score ;

                     var geojsonMarkerOptions = {
                        radius: 4,
                        fillColor: getColor(weightedscore),
                        color: getColor(weightedscore),
                        weight: 1,
                        opacity: 0.6,
                        fillOpacity: 0.6
                        }
                     marker = L.circleMarker([currentDataPoint.latitude, currentDataPoint.longitude], geojsonMarkerOptions);
                     map.addLayer(marker);
                  }
               }
            }
         </script>
      </div>
   </body>
</html>